{# @copyright   Copyright (C) 2010-2024 Combodo SARL #}
{# @license     http://opensource.org/licenses/AGPL-3.0 #}

{% extends "MFAUserSettingsConfigBase.html.twig" %}

{% set sTitle = 'MFATOTP:Mail:Config:Title'|dict_s %}

{% block configuration %}
	{% set sEmail = oMFAUserSettings.Get("email") %}
	{% if sEmail %}
		{% set sEmailSettingsTitle = 'MFATOTP:Mail:Settings:Step1:ChangeEmailOptional'|dict_s %}
		{% set sEmailSettingsAction = 'MFATOTP:Mail:ChangeEmail:Button'|dict_s %}
	{% else %}
		{% set sEmailSettingsTitle = 'MFATOTP:Mail:Settings:Step1:SetEmail'|dict_s %}
		{% set sEmailSettingsAction = 'MFATOTP:Mail:SetEmail:Button'|dict_s %}
	{% endif %}

	{% UIFieldSet Standard { sLegend:sEmailSettingsTitle } %}
		{% UIForm Standard {sId:"change_email_form"} %}
			{% UIInput ForHidden { sName:'transaction_id', sValue:sTransactionId } %}

			{% UIField Small { sLabel:'MFATOTP:Mail:Settings:email:label'|dict_s, sDescription:'MFATOTP:Mail:Settings:email:label+'|dict_s } %}
				{% if sEmail %}
					{% UIInput Standard { sType:'text', sId:'email_attribute', sName:'email_attribute', sValue:sEmail }  %}
				{% else %}
					{% UIInput Standard { sType:'text', sId:'email_attribute', sName:'email_attribute', sValue:'' }  %}
				{% endif %}
			{% EndUIField %}

			{% UIButton ForPrimaryAction { sLabel:sEmailSettingsAction, bIsSubmit:true } %}
		{% EndUIForm %}
	{% EndUIFieldSet %}
{% endblock %}

{% block validation %}
	{% UIFieldSet Standard { sLegend:'MFATOTP:Mail:Validation'|dict_s } %}
		{% UIField Small { sLabel:'MFA:MFAUserSettingsTOTPMail:Description'|dict_s } %}
			{% UIButton ForPrimaryAction { sLabel:'MFATOTP:Mail:ResendEmail:Button'|dict_s, ToolTip:'MFATOTP:Mail:ResendEmail:Button+'|dict_s, OnClickJsCode:"ResendEmail();" } %}
		{% EndUIField %}
		{% UIContentBlock Standard { AddCSSClass:'ibo-v-spacer' } %}{% EndUIContentBlock %}

		{% UIForm Standard {sId:"totp_form"} %}
			{% UIField Small { sLabel:'MFATOTP:Mail:CodeValidation:explain'|dict_s } %}
				{% UIInput ForHidden { sName:'transaction_id', sValue:sTransactionId } %}
				<input type="text" id="totp_code" name="totp_code" value="" size="6"
				       class="ibo-input ibo-block ibo-mfa--code-input" oninput="CheckLoginCode();"
				       data-role="ibo-input" placeholder="{{ 'MFATOTP:EnterCode'|dict_s }}">
			{% EndUIField %}
		{% EndUIForm %}
	{% EndUIFieldSet %}
{% endblock %}

